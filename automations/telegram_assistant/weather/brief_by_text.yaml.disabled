---
id: '65996236441329'
alias: Telegram Assistant - Weather brief by text

trigger:
  - platform: event
    event_type: telegram_text

condition:
  - condition: template
    value_template: '{{trigger.event.data.text|regex_match("(.*)(frio|llov|lluv|calor|nev|clima|temp|snow|rain|weather|tiempo)(.*)",ignorecase=TRUE) }}'

action:
  - service: telegram_bot.send_message
    data_template:
      target: "{{ trigger.event.data.chat_id }}"
      message: >
        {% set salutation = ["ğŸ¤– Hello!","ğŸ¤– Hi!","ğŸ¤– Hola!","ğŸ¤– Hallo!"] | random %}

        {% set season = states('sensor.season') | lower %}

        {% if season == 'winter' %}
          {% set season_emoji = 'â„ï¸' %}
        {% elif season == 'summer' %}
          {% set season_emoji = 'â›±ï¸' %}
        {% elif season == 'spring' %}
          {% set season_emoji = 'ğŸŒ·' %}
        {% else %}
          {% set season_emoji = 'ğŸ' %}
        {% endif %}

        {% set feels_like_temperature = states('sensor.br_feel_temperature') | round %}

        {% if feels_like_temperature < 5 %}
          {% set feels_like_emoji = 'ğŸ¥¶' %}
        {% elif 5 <= feels_like_temperature < 15 %}
          {% set feels_like_emoji = 'ğŸ˜Œ' %}
        {% elif 15 <= feels_like_temperature < 25 %}
          {% set feels_like_emoji = 'ğŸ˜' %}
        {% else %}
          {% set season_emoji = 'ğŸ¥µ' %}
        {% endif %}

        {% set condition = states('weather.home_2') %}

        {% if condition == 'cloudy' %}
          {% set condition_emoji = 'â˜ï¸' %}
        {% elif condition == 'clear' %}
          {% set condition_emoji = 'â˜€ï¸ï¸' %}
        {% elif condition == 'fog' %}
          {% set condition_emoji = 'â˜ï¸' %}
        {% elif condition == 'rainy' %}
          {% set condition_emoji = 'ğŸŒ§ï¸' %}
        {% elif condition == 'lightning' %}
          {% set condition_emoji = 'ğŸŒ©ï¸âš¡ï¸ï¸' %}
        {% endif %}

        {% if 5 < now().hour < 12 %}
          {% set greetings = "Good morning â˜•ï¸ğŸ¥" %}
        {% elif now().hour < 18 %}
          {% set greetings = "Good afternoon ğŸ‘‹ğŸ»" %}
        {% else %}
          {% set greetings = "Good evening ğŸ˜´" %}
        {% endif %}

        {{ salutation }} {{ greetings }}


        {{ season_emoji }} This {{ states('sensor.season') }} day is *{{ states('sensor.br_full_condition') | lower }}* {{ condition_emoji }} and it's going to be {{ states('sensor.br_full_condition_1d') | lower }}


        The temperature right now is *{{ states('sensor.br_temperature') | round }}Â°C* and it *feels like {{ feels_like_temperature }}Â°C* {{ feels_like_emoji }}. The lowest temperature will be {{ states('sensor.br_minimum_temperature_1d') | round }}Â°C


        The temperature inside the house is *{{ states('sensor.air_purifier_temp') | round }}Â°C*