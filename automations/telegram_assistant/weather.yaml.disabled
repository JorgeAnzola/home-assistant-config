---
alias: "Weather assistant"
trigger:
  - platform: event
    event_type: telegram_text
condition:
  - condition: template
    value_template: '{{trigger.event.data.text|regex_match("(.*)(frio|llov|lluv|calor|nev|clima|temp|snow|rain|weather|tiempo)(.*)",ignorecase=TRUE) }}'
action:
  - service: notify.admin_telegram
    data:
      message: >
        {% set temperature = states('sensor.weather_temperature') | round %}

        {% set condition = states('sensor.weather_weather') %}

        {% set wind_speed = states('sensor.weather_wind_speed') %}

        {% set wind_chill = wind_speed %}

        {% set feels_like = (wind_chill * 10 ) % 10 | round %}

        {% set response = 'Â¡Hola!, ' %}

        {% set response = response ~ 'tenemos ' ~ condition ~ ', ' %}

        {% set response = response ~ 'una temperatura de ' ~ temperature ~ 'Â°C (Se siente como ' ~ feels_like ~ 'Â°C)' %}

        {% if temperature <= 10 %}
          {% set response = response ~ 'ğŸ¥¶, ' %}
        {% elif 10 < temperature < 25 %}
          {% set response = response ~ 'ğŸ˜Œ, ' %}
        {% else %}
          {% set response = response ~ 'ğŸ¥µ, ' %}
        {% endif %}

        {% if states('sensor.weather_rain') == 'not raining' %}
          {% set response = response ~ 'no estÃ¡ lloviendo' %}
        {% else %}
          {% set response = response ~ 'estÃ¡ lloviendo â˜”ï¸' %}
        {% endif %}

        {% if states('sensor.weather_snow') != 'not snowing' %}
          {% set response = response ~ 'Â¡ESTÃ NEVANDO â„ï¸â›„ï¸!' %}
        {% endif %}

        {{ response }}
